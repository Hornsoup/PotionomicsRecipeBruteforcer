<div class="wrapper">
    <div class="panelContainer">
        <div class="leftPanel">
            <button *ngIf="!mainLoopService.started" (click)="startClick()">Start</button>
            <button *ngIf="!mainLoopService.started" (click)="resetClick()">Reset</button>
            <button *ngIf="mainLoopService.started" (click)="startClick()">Pause</button>
            <span [matTooltipShowDelay]="500"
                matTooltip="Added quality selection. Bugfixes for multiple traits, price increase for Rank, wild empty recipe, and ignored ingredients.">
                v.0.2.0 Hover for more</span>
            <div *ngIf="!mainLoopService.started"> paused</div>
            <div [matTooltipShowDelay]="1000" matTooltip="If this pauses then the simulation is frozen. Stuttering is normal while running."> Time since refresh: {{(mainLoopService.currentTime - mainLoopService.refreshTime) / 1000}}</div>
            &nbsp;
            <div> Cauldron ingredient target: <input type="number" min="2" max="20" value="{{recipeService.ingredCount}}" (change)="ingredCountChange($event)"></div>
            <div> Cauldron magamin max: <input type="number" min="0" max="2000" value="{{recipeService.maxMagamin}}" (change)="magaminChange($event)"></div>
            Formula: <select (change)="formulaUpdate($event)">
                <option *ngFor="let formula of ingredientsService.formulas" value="{{formula.type}}"
                [selected]="formula.type === recipeService.selectedFormula">{{formula.name}}</option>
            </select>
            <div></div>
            Minimum Quality: <select (change)="qualityUpdate($event)">
                <option *ngFor="let quality of qualitySelection" value="{{quality}}"
                [selected]="quality === recipeService.selectedQuality">{{quality}}</option>
            </select>
            <div [matTooltipShowDelay]="200" matTooltip="Include an average barter increase and shelf increase">
                Shop % bonus: <input type="number" min="0" max="10000" value="{{recipeService.shopBonus}}" (change)="bonusChange($event)">
            </div>
            <p></p>
            <div> Total tries: {{recipeService.totalCount}}</div>
            <div> Recipes found: {{recipeService.hitCount}}</div>
            <table *ngFor="let j of recipeService.indexer; let i = index">
                Ingredient {{i + 1}} remaining checks: {{j}}
            </table>
        </div>
        <div class="rightPanel" *ngIf="!mainLoopService.started">
            <div> 
                <button (click)="filterRecipe()" class="{{ingredientsService.filter == true ? 'filtered' : ''}}">
                Filter Recipe
                </button>
                Add good: 
                <button (click)="setTrait(senses.Taste)" class="{{recipeService.traits[senses.Taste] ? 'filtered' : ''}}">Taste</button>                
                <button (click)="setTrait(senses.Touch)" class="{{recipeService.traits[senses.Touch] ? 'filtered' : ''}}">Touch</button>
                <button (click)="setTrait(senses.Smell)" class="{{recipeService.traits[senses.Smell] ? 'filtered' : ''}}">Smell</button>
                <button (click)="setTrait(senses.Sight)" class="{{recipeService.traits[senses.Sight] ? 'filtered' : ''}}">Sight</button>
                <button (click)="setTrait(senses.Sound)" class="{{recipeService.traits[senses.Sound] ? 'filtered' : ''}}">Sound</button>
                <span [matTooltipShowDelay]="200" matTooltip="Note that illusions don't count for orders."> Illusion:
                <button (click)="setIllusion(senses.Taste)" class="{{recipeService.illusion == senses.Taste ? 'filtered' : ''}}">Taste</button>                
                <button (click)="setIllusion(senses.Touch)" class="{{recipeService.illusion == senses.Touch ? 'filtered' : ''}}">Touch</button>
                <button (click)="setIllusion(senses.Smell)" class="{{recipeService.illusion == senses.Smell ? 'filtered' : ''}}">Smell</button>
                <button (click)="setIllusion(senses.Sight)" class="{{recipeService.illusion == senses.Sight ? 'filtered' : ''}}">Sight</button>
                <button (click)="setIllusion(senses.Sound)" class="{{recipeService.illusion == senses.Sound ? 'filtered' : ''}}">Sound</button>
                </span>
            </div>
            <div>
                Clear inventory: 
                <button (click)="halveInventory()">Half</button>
                <button (click)="selectRarityChange('9-Common')">Common</button>
                <button (click)="selectRarityChange('4-Uncommon')">Uncommon</button>
                <button (click)="selectRarityChange('2-Rare')">Rare</button>
                <button (click)="selectRarityChange('1-Epic')">Epic</button>     
                <button (click)="selectWeekChange(1)">Midweek 1+</button>         
                <button (click)="selectWeekChange(2)">Week 2+</button>     
                <button (click)="selectWeekChange(3)">Week 3+</button>     
                <button (click)="selectWeekChange(4)">Week 4+</button>     
                <button (click)="selectWeekChange(5)">Week 5</button>
            </div>
            Change all: <input type="number" min="0" max="20" (change)="allAvailChange($event)">
            <button (click)="setToQuinns()">Set to Quinn's</button>
            <button (click)="dataService.saveData()">Save Settings</button>
            <button (click)="dataService.loadData()">Load Settings</button>
            <button (click)="dataService.clearData()">Clear Settings</button>
            
            Click header to sort
            <table>
                <tr>
                    <td (click)="ingredientsService.ingredientSort(1)">Name<mat-icon *ngIf="sortCheck(1,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(1,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(2)">A<mat-icon *ngIf="sortCheck(2,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(2,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(3)">B<mat-icon *ngIf="sortCheck(3,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(3,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(4)">C<mat-icon *ngIf="sortCheck(4,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(4,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(5)">D<mat-icon *ngIf="sortCheck(5,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(5,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(6)">E<mat-icon *ngIf="sortCheck(6,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(6,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(7)">Total<mat-icon *ngIf="sortCheck(7,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(7,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(8)">Cost<mat-icon *ngIf="sortCheck(8,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(8,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(9)">Taste<mat-icon *ngIf="sortCheck(9,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(9,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(10)">Touch<mat-icon *ngIf="sortCheck(10,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(10,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(11)">Smell<mat-icon *ngIf="sortCheck(11,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(11,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(12)">Sight<mat-icon *ngIf="sortCheck(12,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(12,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(13)">Sound<mat-icon *ngIf="sortCheck(13,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(13,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(14)">Rarity<mat-icon *ngIf="sortCheck(14,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(14,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(15)">Location<mat-icon *ngIf="sortCheck(15,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(15,true)">keyboard_arrow_down</mat-icon></td>
                    <td (click)="ingredientsService.ingredientSort(16)">Type<mat-icon *ngIf="sortCheck(16,false)">keyboard_arrow_up</mat-icon><mat-icon *ngIf="sortCheck(16,true)">keyboard_arrow_down</mat-icon></td>
                    <td>Inventory</td>
                    <td>Must-haves</td>
                </tr>
                <ng-container *ngFor="let ingredient of ingredientsService.ingredients; let i = index">
                    <tr [ngClass]="ingredCheck(ingredient.index)" >
                        <td>{{ingredient.name}}</td>
                        <td>{{ingredient.A}}</td>
                        <td>{{ingredient.B}}</td>
                        <td>{{ingredient.C}}</td>
                        <td>{{ingredient.D}}</td>
                        <td>{{ingredient.E}}</td>
                        <td>{{ingredient.Total}}</td>
                        <td>{{ingredient.cost}}</td>
                        <td>{{ingredient.Taste}}</td>
                        <td>{{ingredient.Touch}}</td>
                        <td>{{ingredient.Smell}}</td>
                        <td>{{ingredient.Sight}}</td>
                        <td>{{ingredient.Sound}}</td>
                        <td>{{ingredient.Rarity}}</td>
                        <td>{{ingredient.Location}}</td>
                        <td>{{ingredient.Type}}</td>
                        <td><input type="number" min="0" max="999"
                                value="{{ingredient.Avail}}" (change)="ingredAvailChange($event, i)">
                        </td>
                        <td><input type="number" min="0" max="20"
                                value="{{ingredient.Avail}}" (change)="mustHaveChange($event, i)">
                        </td>
                        <!-- @TODO add must haves and related warning-->
                        <td *ngIf="ingredient.Avail <= ingredient.Avail"> <span style="color: red;"> I'm red! </span></td>
                    </tr>
                </ng-container>
            </table>
        </div>
    </div>
    <div class="panelContainer">
        <cdk-virtual-scroll-viewport itemSize="14px" class="bottomPanel" maxBufferPx="800">
            <table>
                <span *ngIf="mainLoopService.started">Simulation running, pause and wait for current results to sort...</span>
                <ng-container *ngIf="!mainLoopService.started">
                    Results below. Shows top 1000 sorted descending by profit.
                    <tr *ngIf="recipeService.recipeListDisplay.length >= 1" text-align="center">
                        <td>Name</td>
                        <td>Cost</td>
                        <td>Rank</td>
                        <td>Value</td>
                        <td>Ratio</td>
                        <td>Profit</td>
                        <td>Taste</td>
                        <td>Touch</td>
                        <td>Smell</td>
                        <td>Sight</td>
                        <td>Sound</td>
                        <td>Deviation</td>
                    </tr>
                    <ng-container *ngFor="let recipe of recipeService.recipeListDisplay; let i = index;">
                        <tr *ngIf="i < recipeService.recipeListDisplay.length">
                            <td>{{i + 1}}: {{recipe.name}}</td>
                            <td>{{recipe.cost}}</td>
                            <td>{{recipe.rank.rank}}</td>
                            <td>{{recipe.value}}*{{recipeService.potionCount()}}</td>
                            <td>{{recipeRatio(i)}}</td>
                            <td>{{recipe.value * recipeService.potionCount() - recipe.cost}}</td>
                            <td>{{recipe.Taste}}</td>
                            <td>{{recipe.Touch}}</td>
                            <td>{{recipe.Smell}}</td>
                            <td>{{recipe.Sight}}</td>
                            <td>{{recipe.Sound}}</td>
                            <td>{{recipe.deviation*100}}%</td>
                        </tr>
                    </ng-container>
                </ng-container>
            </table>
        </cdk-virtual-scroll-viewport>
    </div>
</div>